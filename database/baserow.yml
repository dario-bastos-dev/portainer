service:
  baserow:
   hostname: "{{.Service.Name}}.{{.Task.Slot}}"
   image: baserow/baserow:latest
   environment:
      # Configuração Front-end
      - BASEROW_PUBLIC_URL=https://${BASEROW_PUBLIC_URL}
      - BASEROW_MAX_IMPORT_FILE_SIZE_MB=512

      # Configuração Back-end
      - SECRET_KEY=${SECRET_KEY}
      - BASEROW_BACKEND_LOG_LEVEL=INFO
      - BASEROW_BACKEND_DATABASE_LOG_LEVEL=WARNING

      # Banco de dados
      - DATABASE_HOST=postgres
      - DATABASE_USER=${POSTGRES_USER}
      - DATABASE_PORT=5432
      - DATABASE_NAME=baserow
      - DATABASE_PASSWORD=${POSTGRES_PASSWORD}
      - BASEROW_TRIGGER_SYNC_TRMPLATES_AFTER_MIGRATION=false
      - BASEROW_ROW_PAGE_SIZE_LIMIT=200
      - BATCH_ROWS_SIZE_LIMIT=200
      
   volumes:
      - baserow_data:/baserow/data
   networks:
      - dev-network
      - traefik-public
   deploy:
      labels:
        # --- Configuração do Traefik ---
        - traefik.enable=true

        # --- Roteador ---
        - traefik.http.routers.baserow.rule=Host(`baserow.<YOUR_DOMAIN>`)
        - traefik.http.routers.baserow.entrypoints=websecure
        - traefik.http.routers.baserow.service=baserow
        - traefik.http.routers.baserow.tls.certresolver=letsencrypt

        # --- Serviço ---
        - traefik.http.services.baserow.loadbalancer.server.port=80
        - traefik.http.services.baserow.loadbalancer.passHostHeader=true
      mode: replicated
      replicas: 1
      placement:
        constraints:
          - node.role == manager

volumes:
  baserow_data:

networks:
  dev-network:
    external: true
  traefik-public:
    external: true